<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.serv">

	<resultMap id="insertServ" type="servVO">
		   <result property="cust_serv_no" column="cust_serv_no" />
		   <result property="cust_serv_title" column="cust_serv_title" />
		   <result property="cust_serv_content" column="cust_serv_content" />
		   <result property="mem_id" column="mem_id" />
		   <result property="cust_serv_date" column="cust_serv_date" />
		   <result property="cust_serv_hits" column="cust_serv_hits" />
		   <result property="cust_serv_pw" column="cust_serv_pw" />
		   <result property="cust_serv_notice" column="cust_serv_notice" />
		   <result property="imageFileName" column="imageFileName" />
		   <result property="originalFileName" column="originalFileName" />
	</resultMap>

	<resultMap id="servImageResult" type="servImageFileVO">
	   <result property="img_no" column="img_no" />
	   <result property="img_name" column="img_name" />
	   <result property="img_date" column="img_date" />
	   <result property="cust_serv_no" column="cust_serv_no" />
	</resultMap>
 
   
   <!-- 목록+페이징 v-->
   <select id="servList" resultType="servVO"  parameterType="Criteria3">
    <![CDATA[
    select cust_serv_no, cust_serv_title, cust_serv_content, mem_id, cust_serv_date, cust_serv_hits
    from (
        select cust_serv_no, cust_serv_title, cust_serv_content, mem_id, cust_serv_date, cust_serv_hits,
            row_number() over(order by cust_serv_no desc) as rNum2
        from  GOGI_CUST_SERV_BOARD
        ) mb2
    where rNum2 between  #{rowStart} and #{rowEnd}
        order by cust_serv_no desc
         ]]>
</select>
 
 
   <!-- :게시물 총 갯수 확인 - -->
<!-- 번호만 있으면 확인 가능해 매개변수 타입 정수로 설정 -->
<select id="servListCount" resultType="int">
   <![CDATA[
 select count(cust_serv_no) from GOGI_CUST_SERV_BOARD
 where cust_serv_no > 0
  ]]>
</select>

    <!-- -작성 -->
   <insert id="servWrite" parameterType="java.util.Map">
    insert into GOGI_CUST_SERV_BOARD(cust_serv_no, cust_serv_title, cust_serv_content,mem_id,cust_serv_pw)
        values (seq_serv.nextval, #{cust_serv_title}, #{cust_serv_content}, #{mem_id},#{cust_serv_pw})
 	</insert>
 	
 	
 	<insert id="insertServImageFile" parameterType="servImageFileVO" >
      <selectKey resultType="int" keyProperty="img_no" order="BEFORE">
          select seq_image_no.nextval from dual
       </selectKey>
       <![CDATA[
         insert into GOGI_SERV_IMAGE (img_no,
                                      img_name,
	                                  img_date,
	                                  cust_serv_no)
                             values(#{img_no},
                                  #{img_name},
                                  sysdate,
                                  #{cust_serv_no})
      ]]>
   </insert>
   
   <!-- 조회 -->
   <select id="servRead" resultType="servVO" parameterType="int">
	select cust_serv_no, cust_serv_title, cust_serv_content,mem_id, cust_serv_date,cust_serv_hits
	from GOGI_CUST_SERV_BOARD
	where cust_serv_no = #{cust_serv_no}
   </select>
   
   
   <!--  조회수  -->
 <update id="updateServViewCnt">
    update GOGI_CUST_SERV_BOARD
    set 
    cust_serv_hits = cust_serv_hits +1
    where cust_serv_no = #{cust_serv_no}
</update>



   <!--  수정 -->   
   <update id="servUpdate" parameterType="servVO">
    update GOGI_CUST_SERV_BOARD
     set
      cust_serv_title = #{cust_serv_title},
      cust_serv_content = #{cust_serv_content},
      mem_id=#{mem_id}
  where cust_serv_no = #{cust_serv_no}
   </update>
   
   <!-- 비밀번호 값 받아오기 -->
      <select id="servGetPw" resultType="int" parameterType="int">
	select cust_serv_pw
	from GOGI_CUST_SERV_BOARD
	where cust_serv_no = #{cust_serv_no}
   </select>
 
   
   <!--  삭제 -->
   <delete id="servDelete" parameterType="int">
    delete from
    GOGI_CUST_SERV_BOARD
  where cust_serv_no = #{cust_serv_no}
   </delete>
   </mapper>